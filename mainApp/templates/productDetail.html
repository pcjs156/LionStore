{% extends 'base.html' %}
{% load static %}

{% block head %}
<title>ìƒí’ˆë³„ ë””í…Œì¼ í˜ì´ì§€</title>
<!-- ìƒí’ˆë³„ ë””í…Œì¼ í˜ì´ì§€
     ìƒí’ˆ ì •ë³´, ë¦¬ë·° ëª©ë¡, ì›¹ íŒë§¤ ì •ë³´ ëª©ë¡, ë¬¸êµ¬ì  ì •ë³´ ëª©ë¡ì´ ë…¸ì¶œë¨ -->
{% endblock %}

{% block content %}
<a href="{% url 'productList' product.category.id %}">ì œí’ˆ ëª©ë¡ ë³´ê¸°</a>

<div>ì œí’ˆëª… : {{ product.name }}</div>
<div>ì œì¡°ì‚¬ : {{ product.manufacturer }}</div>
<div>ì œí’ˆ ì„¤ëª… : {{ product.description }}</div>
<br>

{{ likeMessage }}
<a href="{% url 'productLikeProcess' product_id=product.id %}">
     {% if userLike %}
     <!-- ìœ ì €ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²½ìš° -->
     â¤ï¸
     {% else %}
     <!-- ìœ ì €ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì§€ ì•Šì€ ê²½ìš° -->
     ğŸ–¤
     {% endif %}
</a>

<hr>

<!-- ì¸ê¸°ìˆœ ì •ë ¬ë¡œ ì „í™˜ -->
{% if popularitySort %}
<div><span>ì¸ê¸°ìˆœ ì •ë ¬</span> / <span><a href="{% url 'productDetail' product.id %}?sort=new">ìµœì‹ ìˆœì •ë ¬</a></span></div>
<!-- ìµœì‹ ìˆœ ì •ë ¬ë¡œ ì „í™˜ -->
{% else %}
<div><span><a href="{% url 'productDetail' product.id %}?sort=popularity">ì¸ê¸°ìˆœ ì •ë ¬</a></span> / <span>ìµœì‹ ìˆœì •ë ¬</span></div>
{% endif %}

{% if not reviewCreated %}
<!-- ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ì§€ ì•Šì€ ê²½ìš° -->
<div><a href="{% url 'reviewCreate' product.id %}">ìƒˆ ë¦¬ë·° ì‘ì„±</a></div>
{% else %}
<!-- ë¦¬ë·°ë¥¼ ì´ë¯¸ ì‘ì„±í•œ ê²½ìš° -->
<div><a href="{% url 'reviewDetail' myReview.id %}">ì‘ì„±í•œ ë¦¬ë·° ë³´ê¸°</a></div>
{% endif %}

{% for review in reviews %}
<div><a href="{% url 'reviewDetail' review.id %}">ë¦¬ë·° {{ review.id }} ({{ review.pub_date | date:"Y/m/d a h:i" }})</a></div>
{% endfor %}

<!-- ì¸ê¸°ìˆœ ì •ë ¬ì¸ ê²½ìš° -->
{% if popularitySort %}

     {% if reviews.has_previous %}
     <a href="?page=1&sort=popularity">ë§¨ ì•ìœ¼ë¡œ</a>
     <a href="?page={{ reviews.previous_page_number }}&sort=popularity">ì´ì „ìœ¼ë¡œ</a>
     {% endif %}
     <span>{{ reviews.number }}</span>
     <span>/</span>
     <span>{{ reviews.paginator.num_pages }}</span>
     {% if reviews.has_next %}
     <a href="?page={{ reviews.next_page_number }}&sort=popularity">ë‹¤ìŒìœ¼ë¡œ</a>
     <a href="?page={{ reviews.paginator.num_pages }}&sort=popularity">ë§¨ ë’¤ë¡œ</a>
     {% endif %}

     <hr>
     <div style="font-weight: bold;">íƒœê·¸ëª©ë¡</div>
     {% for tag in tags %}
     <div><a href="{% url 'tagProduct' tag.id %}">{{ tag }}</a></div>
     {% endfor %}

<!-- ìµœì‹ ìˆœ ì •ë ¬ì¸ ê²½ìš° -->
{% else %}

     {% if reviews.has_previous %}
     <a href="?page=1&sort=new">ë§¨ ì•ìœ¼ë¡œ</a>
     <a href="?page={{ reviews.previous_page_number }}&sort=new">ì´ì „ìœ¼ë¡œ</a>
     {% endif %}
     <span>{{ reviews.number }}</span>
     <span>/</span>
     <span>{{ reviews.paginator.num_pages }}</span>
     {% if reviews.has_next %}
     <a href="?page={{ reviews.next_page_number }}&sort=new">ë‹¤ìŒìœ¼ë¡œ</a>
     <a href="?page={{ reviews.paginator.num_pages }}&sort=new">ë§¨ ë’¤ë¡œ</a>
     {% endif %}

     <hr>
     <div style="font-weight: bold;">íƒœê·¸ëª©ë¡</div>
     {% for tag in tags %}
     <div>{{ tag }}</div>
     {% endfor %}

{% endif %}

<hr>

<!-- ì›¹ íŒë§¤ìì¸ ê²½ìš°ì—ë§Œ íŒë§¤ì •ë³´ ì…ë ¥ ê°€ëŠ¥ -->
{% if user.is_WebSeller %}
<a href="{% url 'webSellInfoCreate' product_id=product.id %}">ì›¹ íŒë§¤ì •ë³´ ì¶”ê°€</a>
{% endif %}

{% for info in webSellInfoList %}
<div>
     {% if info.price == cheapestWebPrice %}
     <!-- ìµœì €ê°€ì¸ ê²½ìš° ë¶‰ì€ ìƒ‰ìœ¼ë¡œ ë³´ì´ë„ë¡ í‘œì‹œ -->
     <div style="color: red;">íŒë§¤ì : {{ info.seller.nickname }}</div>
     <div style="color: red;">ê°€ê²© : {{ info.price }}ì›</div>
     {% else %}
     <div>íŒë§¤ì : {{ info.seller.nickname }}</div>
     <div>ê°€ê²© : {{ info.price }}ì›</div>
     {% endif %}
     <div><a href="{% url 'redirectExternalLink' link=info.link %}">êµ¬ì…í•˜ëŸ¬ ê°€ê¸°</a></div>

     {% if info.seller == user %}
     <!-- íŒë§¤ìì¸ ê²½ìš° ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ì— ì ‘ê·¼ ê°€ëŠ¥ -->
     <div>
          <div><a href="{% url 'webSellInfoDelete' product_id=product.id webSellInfo_id=info.id %}">íŒë§¤ì •ë³´ ì‚­ì œí•˜ê¸°</a></div>
          <div><a href="{% url 'webSellInfoModify' product_id=product.id webSellInfo_id=info.id %}">íŒë§¤ì •ë³´ ìˆ˜ì •í•˜ê¸°</a></div>
     </div>
     {% endif %}
</div>
<br>
{% endfor %}

<hr>

{% if user.is_Stationer %}
<!-- ë¬¸êµ¬ì  ì‚¬ì¥ë‹˜ì¸ ê²½ìš°ì—ë§Œ íŒë§¤ì •ë³´ ì…ë ¥ ê°€ëŠ¥ -->
<div><a href="{% url 'stationerSellInfoCreate' product_id=product.id %}">ë¬¸êµ¬ì  íŒë§¤ì •ë³´ ì¶”ê°€</a></div>
{% endif %}

{% if hasStationerSellInfo %}
<!-- ë¬¸êµ¬ì  íŒë§¤ì •ë³´ê°€ ë“±ë¡ëœ ê²½ìš° -->
{% if nullLocation %}
<!-- ìœ„ì¹˜ ì •ë³´ê°€ ì…ë ¥ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° -->
<div>ìœ„ì¹˜ ì •ë³´ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>
<div>ì§€ë„ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì‹œë ¤ë©´ <a href="{% url 'setLocation' %}">ìœ„ì¹˜ë¥¼ ì„¤ì •</a>í•´ì£¼ì„¸ìš”.</div>
{% else %}
<!-- ìœ„ì¹˜ ì •ë³´ê°€ ì…ë ¥ë˜ì–´ ìˆëŠ” ê²½ìš° -->
<div id="map" style="width:100%;height:350px;"></div>
{% endif %}

{% for info in stationerSellInfoList %}
<div>
     {% if info.price == cheapestStationerPrice %}
     <!-- ìµœì €ê°€ì¸ ê²½ìš° ë¶‰ì€ ìƒ‰ìœ¼ë¡œ ë³´ì´ë„ë¡ í‘œì‹œ -->
     <div style="color: red;">íŒë§¤ì : {{ info.seller.nickname }}</div>
     <div style="color: red;">ê°€ê²© : {{ info.price }}ì›</div>
     {% else %}
     <div>íŒë§¤ì : {{ info.seller.nickname }}</div>
     <div>ê°€ê²© : {{ info.price }}ì›</div>
     {% endif %}

     {% if info.seller == user %}
     <!-- íŒë§¤ìì¸ ê²½ìš° ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ì— ì ‘ê·¼ ê°€ëŠ¥ -->
     <div>
          <div><a href="{% url 'stationerSellInfoDelete' product_id=product.id stationerSellInfo_id=info.id %}">íŒë§¤ì •ë³´ ì‚­ì œí•˜ê¸°</a></div>
          <div><a href="{% url 'stationerSellInfoModify' product_id=product.id stationerSellInfo_id=info.id %}">íŒë§¤ì •ë³´ ìˆ˜ì •í•˜ê¸°</a></div>
     </div>
     {% endif %}
</div>
<br>
{% endfor %}

{% else %}
<!-- ë¬¸êµ¬ì  íŒë§¤ì •ë³´ê°€ ë“±ë¡ë˜ì§€ ì•Šì€ ê²½ìš° -->
<div>ë¬¸êµ¬ì  íŒë§¤ì •ë³´ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!</div>
{% endif %}


<script>
var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
    mapOption = { 
        center: new kakao.maps.LatLng({{ centerLatitude }}, {{ centerLongitude }}), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
        level: {{ zoomLevel }} // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
    };

var map = new kakao.maps.Map(mapContainer, mapOption);

{% for info in stationerSellInfoList %}

// ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤ 
var markerPosition  = new kakao.maps.LatLng({{ info.seller.latitude }}, {{ info.seller.longitude }}); 

// ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var marker = new kakao.maps.Marker({
    position: markerPosition
});

// ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
marker.setMap(map);

var iwContent = '<div style="padding: 2px;">{{ info.seller.nickname }} : {{ info.price }}</div>', // ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë  ë‚´ìš©ìœ¼ë¡œ HTML ë¬¸ìì—´ì´ë‚˜ document elementê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
    iwPosition = new kakao.maps.LatLng({{ info.seller.latitude }}, {{ info.seller.longitude }}); //ì¸í¬ìœˆë„ìš° í‘œì‹œ ìœ„ì¹˜ì…ë‹ˆë‹¤

// ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
var infowindow = new kakao.maps.InfoWindow({
    position : iwPosition, 
    content : iwContent 
});
  
// ë§ˆì»¤ ìœ„ì— ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì¸ markerë¥¼ ë„£ì–´ì£¼ì§€ ì•Šìœ¼ë©´ ì§€ë„ ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
infowindow.open(map, marker); 

{% endfor %}
</script>
<hr>

ê´€ë ¨ ì˜ìƒ <br>
{% for linkHash in videoLinkHashs %}
<iframe width="200" height="180" src="https://www.youtube.com/embed/{{ linkHash }}" frameborder="0"
     allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
{% endfor %}
{% endblock %}