{% extends 'base.html' %}
{% load static %}

{% block head %}
<title>ìƒí’ˆë³„ ë””í…Œì¼ í˜ì´ì§€</title>
<!-- ìƒí’ˆë³„ ë””í…Œì¼ í˜ì´ì§€
     ìƒí’ˆ ì •ë³´, ë¦¬ë·° ëª©ë¡, ì›¹ íŒë§¤ ì •ë³´ ëª©ë¡, ë¬¸êµ¬ì  ì •ë³´ ëª©ë¡ì´ ë…¸ì¶œë¨ -->
<style>
     hr {
          width: 80%;
     }
     #webSellInfo_report {
          width: 4rem;
     }
</style>
{% endblock %}

{% block content %}
<a href="{% url 'productList' product.category.id %}">ì œí’ˆ ëª©ë¡ ë³´ê¸°</a>

<div>ì œí’ˆëª… : {{ product.name }}</div>
<div>ì œì¡°ì‚¬ : {{ product.manufacturer }}</div>
<div>ì œí’ˆ ì„¤ëª… : {{ product.description }}</div>
<img src="{{ product.productImage.url }}" alt="{{ product.name }} ì´ë¯¸ì§€">

<div>ì´ì </div>
<div class="rateit svg" data-rateit-value="{{avr_totalScore}}" data-rateit-readonly="true" data-rateit-starwidth="15"
     step="0.1" data-rateit-starheight="15"></div>

<div>ê·¸ë¦½ê°</div>
<div class="rateit svg" data-rateit-value="{{avr_gripScore}}" data-rateit-readonly="true"
     aria-valuenow="{{avr_gripScore}}" data-rateit-starwidth="15" data-rateit-starheight="15"></div>

<div>ìˆ˜ëª…</div>
<div class="rateit svg" data-rateit-value="{{avr_lifeScore}}" data-rateit-readonly="true" data-rateit-starwidth="15"
     data-rateit-starheight="15"></div>

<div>ë‚´êµ¬ë„</div>
<div class="rateit svg" data-rateit-value="{{avr_durabilityScore}}" data-rateit-readonly="true"
     data-rateit-starwidth="15" data-rateit-starheight="15"></div>

<div>ë””ìì¸</div>
<div class="rateit svg" data-rateit-value="{{avr_designScore}}" data-rateit-readonly="true" data-rateit-starwidth="15"
     data-rateit-starheight="15"></div>

<div>ì‚¬ìš©ê°</div>
<div class="rateit svg" data-rateit-value="{{avr_textureScore}}" data-rateit-readonly="true" data-rateit-starwidth="15"
     data-rateit-starheight="15"></div>

<div>ê°€ì„±ë¹„</div>
<div class="rateit svg" data-rateit-value="{{avr_costEffetivenessScore}}" data-rateit-readonly="true"
     data-rateit-starwidth="15" data-rateit-starheight="15"></div>

<br>



<div id="tagContainer" style="width: 80%; margin: 0 auto 1rem auto; text-align: right;">
     <div style="font-family: 'yg-jalnan'; color: black;"><i class="fa fa-tags" aria-hidden="true"></i>íƒœê·¸ëª©ë¡</div>
     {% if tags %}
          {% for tag in tags %}
          <a class="badge badge-pill badge-warning" href="{% url 'tagProduct' tag.id %}">{{ tag }}</a>
          {% endfor %}
     {% else %}
          <span class="badge badge-pill badge-danger">No TAG</span>
     {% endif %}
</div>

<div style="width: 80%; margin: 0 auto 2rem auto; text-align: right;">
     {{ likeMessage }}
     <a href="{% url 'productLikeProcess' product_id=product.id %}">
          {% if userLike %}
          <!-- ìœ ì €ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²½ìš° -->
          â¤ï¸
          {% else %}
          <!-- ìœ ì €ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì§€ ì•Šì€ ê²½ìš° -->
          ğŸ–¤
          {% endif %}
     </a>
</div>

<hr>

<div id="reviewContainer" style="padding: 0 15%">
     <!-- ì¸ê¸°ìˆœ ì •ë ¬ë¡œ ì „í™˜ -->
     {% if popularitySort %}
     <div class="h6" style="text-align: left; font-family: 'yg-jalnan'; padding-left: 0.3rem;"><i class="fa fa-sort" aria-hidden="true"></i><span>ì¸ê¸°ìˆœ ì •ë ¬</span> / <span><a href="{% url 'productDetail' product.id %}?sort=new">ìµœì‹ ìˆœì •ë ¬</a></span></div>
     <!-- ìµœì‹ ìˆœ ì •ë ¬ë¡œ ì „í™˜ -->
     {% else %}
     <div class="h6" style="text-align: left; font-family: 'yg-jalnan'; padding-left: 0.3rem;"><i class="fa fa-sort" aria-hidden="true"></i><span><a href="{% url 'productDetail' product.id %}?sort=popularity">ì¸ê¸°ìˆœ ì •ë ¬</a></span> / <span>ìµœì‹ ìˆœì •ë ¬</span></div>
     {% endif %}

     <div class="row property__gallery">
          {% for review in reviews %}
          <div class="col-lg-3 col-md-4 col-sm-6 mix women">
               <div class="product__item">
                    <div class="product__item__pic set-bg" data-setbg="{{ review.reviewImage1.url }}">
                         <ul class="product__hover">
                              <li><a href="{{ review.reviewImage1.url }}" class="image-popup"><span
                                             class="arrow_expand"></span></a></li>
                         </ul>
                    </div>
                    <div class="product__item__text">
                         <h6><a href="{% url 'reviewDetail' review.id %}">{{ review }}</a></h6>
                         <div class="rating">
                              <div class="rateit svg" data-rateit-value="{{ review.totalScore }}" data-rateit-readonly="true"
                                   data-rateit-starwidth="15" data-rateit-starheight="15">
                              </div>
                         </div>
                    </div>
               </div>
          </div>
          {% endfor %}
     </div>

     {% if not reviewCreated %}
     <!-- ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ì§€ ì•Šì€ ê²½ìš° -->
     <a href="{% url 'reviewCreate' product.id %}"><div style="padding-left: 0.3rem; text-align: right;">ìƒˆ ë¦¬ë·° ì‘ì„±</div></a>
     {% else %}
     <!-- ë¦¬ë·°ë¥¼ ì´ë¯¸ ì‘ì„±í•œ ê²½ìš° -->
     <a href="{% url 'reviewDetail' myReview.id %}"><div style="padding-left: 0.3rem; text-align: right;">ì‘ì„±í•œ ë¦¬ë·° ë³´ê¸°</div></a>
     {% endif %}

     <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
     <div class="pagination__option" style="text-align: center;">
          {% if reviews.has_previous %}
          <a href="?page=1&sort={{ sortBy }}"><i class="fa fa-angle-double-left" aria-hidden="true"></i></a>
          <a href="?page={{ reviews.previous_page_number }}&sort={{ sortBy }}"><i class="fa fa-angle-left"></i></a>
          {% else %}
          <a href="?page=1&sort={{ sortBy }}"><i class="fa fa-angle-double-left" aria-hidden="true"></i></a>
          <a href="#"><i class="fa fa-step-backward" aria-hidden="true"></i></a>
          {% endif %}
          <span>{{ reviews.number }}</span>
          <span>/</span>
          <span>{{ reviews.paginator.num_pages }}</span>
          {% if reviews.has_next %}
          <a href="?page={{ reviews.next_page_number }}&sort={{ sortBy }}"><i class="fa fa-angle-right"></i></a>
          <a href="?page={{ reviews.paginator.num_pages }}&sort={{ sortBy }}"><i class="fa fa-angle-double-right"
                    aria-hidden="true"></i></a>
          {% else %}
          <a href="#"><i class="fa fa-step-forward" aria-hidden="true"></i></a>
          <a href="?page={{ reviews.paginator.num_pages }}&sort={{ sortBy }}"><i class="fa fa-angle-double-right"
                    aria-hidden="true"></i></a>
          {% endif %}
     </div>

</div>

<hr>

<table id="webSellInfos" class="table table-bordered table-hover"
     style="text-align: center; width: 70%; margin: auto auto;">
     <caption style="caption-side: top; font-family: 'yg-jalnan'; color: black;"><i class="fa fa-krw" aria-hidden="true"
               style="font-weight: bold;"></i>ë“±ë¡ëœ íŒë§¤ì •ë³´</caption>
     {% if user.is_WebSeller %}
     <caption style="caption-side: bottom; text-align: right;">
          {% if webSellInfoRegistered %}
          <a href="{% url 'webSellInfoDelete' product_id=product.id webSellInfo_id=targetInfo.id %}">íŒë§¤ì •ë³´ ì‚­ì œí•˜ê¸°</a> /
          <a href="{% url 'webSellInfoModify' product_id=product.id webSellInfo_id=targetInfo.id %}">íŒë§¤ì •ë³´ ìˆ˜ì •í•˜ê¸°</a>
          {% else %}
          <a href="{% url 'webSellInfoCreate' product_id=product.id %}">ì›¹ íŒë§¤ì •ë³´ ì¶”ê°€</a>
          {% endif %}
     </caption>
     {% endif %}
     <thead>
          <tr>
               <th>íŒë§¤ì</th>
               <th>ê°€ê²©</th>
               <th>ë§í¬</th>
               <th>ì‹ ê³ </th>
          </tr>
     </thead>
     <tbody>
          {% if hasWebSellInfo %}
          {% for info in webSellInfoList %}
          <tr>
               <td id="webSellInfo_seller">
                    {{ info.seller.nickname }}
               </td>
               <td id="webSellInfo_price">
                    {{ info.price }}
               </td>
               <td id="webSellInfo_link">
                    <a href="{% url 'redirectExternalLink' info.link %}"><i class="fa fa-external-link"
                              aria-hidden="true">{{ info.link }}</i></a>
               </td>
               <td id="webSellInfo_report">
                    <a href="">ì‹ ê³ </a>
               </td>
          </tr>
          {% endfor %}
          {% else %}
          <tr>
               <td colspan="4">ì•„ì§ íŒë§¤ì •ë³´ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</td>
          </tr>
          {% endif %}
     </tbody>
</table>
<br>

{% if hasStationerSellInfo %}
     <!-- ë¬¸êµ¬ì  íŒë§¤ì •ë³´ê°€ ë“±ë¡ëœ ê²½ìš° -->
     {% if nullLocation %}
          <!-- ìœ„ì¹˜ ì •ë³´ê°€ ì…ë ¥ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° -->
          <div>ìœ„ì¹˜ ì •ë³´ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>
          <div>ì§€ë„ ê¸°ëŠ¥ì„ ì´ìš©í•˜ì‹œë ¤ë©´ <a href="{% url 'setLocation' %}">ìœ„ì¹˜ë¥¼ ì„¤ì •</a>í•´ì£¼ì„¸ìš”.</div>
     {% else %}
          <!-- ìœ„ì¹˜ ì •ë³´ê°€ ì…ë ¥ë˜ì–´ ìˆëŠ” ê²½ìš° -->
          <div style="font-family: 'yg-jalnan'; color: black; width: 70%; margin: 0 auto; padding: 12px 0;"><i class="fa fa-map-marker" aria-hidden="true"></i> ë¬¸êµ¬ì  íŒë§¤ ì •ë³´</div>
          <div id="map" style="width:70%; height:30em; margin: 0 auto;"></div>
     {% endif %}
{% else %}
     <!-- ë¬¸êµ¬ì  íŒë§¤ì •ë³´ê°€ ë“±ë¡ë˜ì§€ ì•Šì€ ê²½ìš° -->
     <div style="font-family: 'yg-jalnan'; color: red; width: 70%; margin: 0 auto; padding: 12px 0;"><i class="fa fa-times" aria-hidden="true"></i>ë¬¸êµ¬ì  íŒë§¤ì •ë³´ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!</div>
     <div id="map" style="width:70%; height:30em; margin: 0 auto;"></div>
{% endif %}

{% if user.is_Stationer %}
     <div style="text-align: right; width: 70%; margin: 0 auto; padding-top: 12px;">
     <!-- ë¬¸êµ¬ì  ì‚¬ì¥ë‹˜ì¸ ê²½ìš°ì—ë§Œ íŒë§¤ì •ë³´ ì…ë ¥/ì‚­ì œ/ìˆ˜ì • ê°€ëŠ¥ -->
     {% if stationerSellInfoRegistered %}
          <a href="{% url 'stationerSellInfoModify' product_id=product.id stationerSellInfo_id=targetInfo.id %}">ë¬¸êµ¬ì  íŒë§¤ì •ë³´ ìˆ˜ì •</a> /
          <a href="{% url 'stationerSellInfoDelete' product_id=product.id stationerSellInfo_id=targetInfo.id %}">ë¬¸êµ¬ì  íŒë§¤ì •ë³´ ì‚­ì œ</a>
     {% else %}
          <a href="{% url 'stationerSellInfoCreate' product_id=product.id %}">ë¬¸êµ¬ì  íŒë§¤ì •ë³´ ì¶”ê°€</a>
     {% endif %}
     </div>
{% endif %}

ê´€ë ¨ ì˜ìƒ <br>
{% for linkHash in videoLinkHashs %}
<iframe width="200" height="180" src="https://www.youtube.com/embed/{{ linkHash }}" frameborder="0"
     allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
{% endfor %}

<script>
     {% if hasStationerSellInfo %}
     var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
         mapOption = { 
             center: new kakao.maps.LatLng({{ centerLatitude }}, {{ centerLongitude }}), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
             level: {{ zoomLevel }} // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
         };
     
     var map = new kakao.maps.Map(mapContainer, mapOption);
     
     {% for info in stationerSellInfoList %}
     
     // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤ 
     var markerPosition  = new kakao.maps.LatLng({{ info.seller.latitude }}, {{ info.seller.longitude }}); 
     
     // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
     var marker = new kakao.maps.Marker({
         position: markerPosition
     });
     
     // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
     marker.setMap(map);
     
     {% if info.price == cheapestStationerPrice %}
     var iwContent = "<div style='color: red; text-align: center;'>{{ info.seller.nickname }} : {{ info.price }}</div>", // ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë  ë‚´ìš©ìœ¼ë¡œ HTML ë¬¸ìì—´ì´ë‚˜ document elementê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
         iwPosition = new kakao.maps.LatLng({{ info.seller.latitude }}, {{ info.seller.longitude }}); //ì¸í¬ìœˆë„ìš° í‘œì‹œ ìœ„ì¹˜ì…ë‹ˆë‹¤
     {% else %}
     var iwContent = "<div>{{ info.seller.nickname }} : {{ info.price }}</div>", // ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë  ë‚´ìš©ìœ¼ë¡œ HTML ë¬¸ìì—´ì´ë‚˜ document elementê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
         iwPosition = new kakao.maps.LatLng({{ info.seller.latitude }}, {{ info.seller.longitude }}); //ì¸í¬ìœˆë„ìš° í‘œì‹œ ìœ„ì¹˜ì…ë‹ˆë‹¤
     {% endif %}

     // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
     var infowindow = new kakao.maps.InfoWindow({
         position : iwPosition, 
         content : iwContent 
     });
       
     // ë§ˆì»¤ ìœ„ì— ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì¸ markerë¥¼ ë„£ì–´ì£¼ì§€ ì•Šìœ¼ë©´ ì§€ë„ ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
     infowindow.open(map, marker); 
     
     {% endfor %}
     {% else %}
     var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
     mapOption = { 
          center: new kakao.maps.LatLng(33.450701, 126.570667), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
          level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
     };

     // ì§€ë„ë¥¼ í‘œì‹œí•  divì™€  ì§€ë„ ì˜µì…˜ìœ¼ë¡œ  ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
     var map = new kakao.maps.Map(mapContainer, mapOption); 
     {% endif %}
     </script>
     {% endblock %}